<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido de Férias 2026</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: none;
            color: #0f3d2e;
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #passwordPrompt, #formContainer {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(15, 61, 46, 0.2);
            max-width: 400px;
            width: 100%;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #0f3d2e;
        }

        select, input[type="date"], input[type="number"], input[type="password"] {
            padding: 8px;
            margin-bottom: 15px;
            width: 100%;
            border: 1px solid #0f3d2e;
            border-radius: 6px;
            background-color: #f8fdfb;
            color: #0f3d2e;
        }

        button {
            padding: 10px 15px;
            background-color: #0f3d2e;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #0c3326;
        }

        .error {
            color: #a33;
            margin-top: 10px;
        }

        .success {
            color: green;
            font-weight: bold;
            margin-top: 15px;
        }

        #detalhesReserva {
            margin-top: 20px;
        }

        #formContainer {
            display: none;
        }

        #novoPedidoBtn {
            background-color: #e6ffec;
            color: #0f3d2e;
            border: 1px solid #0f3d2e;
        }

        #novoPedidoBtn:hover {
            background-color: #d1f7dc;
        }

        h1, h2 {
            text-align: center;
        }
    </style>
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.28.0/dist/supabase.min.js"></script>
</head>
<body>
    <div id="passwordPrompt">
        <h1>Pedidos de Férias 2026</h1>
        <label for="password">Digite a senha para acessar o formulário:</label>
        <input type="password" id="password" required>
        <button onclick="verificarSenha()">Entrar</button>
        <div id="senhaErro" class="error" style="display:none;">Senha incorreta. Tente novamente.</div>
    </div>

    <div id="formContainer">
        <h1>Pedidos de Férias 2026</h1>
        <form id="reservaForm">
            <label for="nome">Nome:</label>
            <select id="nome" required>
                <option value="Andreia Gralha">Andreia Gralha</option>
                <option value="Telma Rosa">Telma Rosa</option>
            </select>

            <label for="tipoDias">Tipo de Dias:</label>
            <select id="tipoDias" required>
                <option value="Preferenciais">Preferenciais</option>
                <option value="Não Preferenciais">Não Preferenciais</option>
            </select>

            <label for="dataInicio">Data de Início:</label>
            <input type="date" id="dataInicio" required>

            <label for="dataFim">Data de Fim:</label>
            <input type="date" id="dataFim" required>

            <div id="diasCalculados">Dias úteis calculados: 0</div>

            <div id="errorMessages" class="error"></div>
            <div id="successMessage" class="success"></div>

            <button type="submit">Enviar</button>
        </form>

        <div id="detalhesReserva"></div>
        <button id="novoPedidoBtn" style="display:none;" onclick="novoPedido()">Submeter Novo Pedido</button>
    </div>

    <script>
        // Supabase
        const SUPABASE_URL = 'https://bijndfsxrzjviwrdvwms.supabase.co';
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpam5kZnN4cnpqdml3cmR2d21zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NTA5NTIsImV4cCI6MjA2NjQyNjk1Mn0.EWaFInuqTaxvnjytb40DdnflEbBrbSYcViKLYc_kKBk";
        const supabase = Supabase.createClient(SUPABASE_URL, supabaseKey);

        // Feriados e fim de semana
        const feriados = ['2025-04-25', '2025-04-18', '2025-05-01'];
        const finDeSemana = [0, 6];

        function isFeriadoOuFimDeSemana(data) {
            const diaDaSemana = data.getDay();
            const dataFormatada = data.toISOString().split('T')[0];
            return finDeSemana.includes(diaDaSemana) || feriados.includes(dataFormatada);
        }

        function calcularDiasEntreDatas(dataInicio, dataFim) {
            const startDate = new Date(dataInicio);
            const endDate = new Date(dataFim);
            let dias = 0;

            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                if (isFeriadoOuFimDeSemana(d)) continue;
                dias++;
            }
            return dias;
        }

        function atualizarDiasCalculados() {
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;

            if (dataInicio && dataFim) {
                const dias = calcularDiasEntreDatas(dataInicio, dataFim);
                document.getElementById('diasCalculados').innerText = `Dias úteis calculados: ${dias}`;
            } else {
                document.getElementById('diasCalculados').innerText = 'Dias úteis calculados: 0';
            }
        }

        document.getElementById('dataInicio').addEventListener('change', atualizarDiasCalculados);
        document.getElementById('dataFim').addEventListener('change', atualizarDiasCalculados);

        function validarDatas() {
            const dataInicio = new Date(document.getElementById('dataInicio').value);
            const dataFim = new Date(document.getElementById('dataFim').value);
            const mensagensErro = [];

            if (isFeriadoOuFimDeSemana(dataInicio)) {
                mensagensErro.push("A data de início não pode ser um fim de semana ou feriado.");
            }
            if (isFeriadoOuFimDeSemana(dataFim)) {
                mensagensErro.push("A data de fim não pode ser um fim de semana ou feriado.");
            }

            for (let d = new Date(dataInicio); d <= dataFim; d.setDate(d.getDate() + 1)) {
                if (isFeriadoOuFimDeSemana(d)) {
                    mensagensErro.push(`O dia ${d.toISOString().split('T')[0]} é um fim de semana ou feriado.`);
                }
            }

            return mensagensErro;
        }

        async function enviarParaSupabase(dados) {
            const { data, error } = await supabase
                .from('pedidos_ferias')
                .insert([dados]);

            if (error) {
                console.error('Erro ao enviar os dados:', error);
                alert('Erro ao enviar o pedido!');
            } else {
                console.log('Pedido enviado:', data);
                document.getElementById('novoPedidoBtn').style.display = 'inline-block';
            }
        }

        document.getElementById('reservaForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const nome = document.getElementById('nome').value;
            const tipoDias = document.getElementById('tipoDias').value;
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;
            const dias = calcularDiasEntreDatas(dataInicio, dataFim);

            const mensagensErro = validarDatas();
            if (mensagensErro.length > 0) {
                document.getElementById('errorMessages').innerHTML = mensagensErro.join('<br>');
                document.getElementById('successMessage').innerText = '';
                return;
            }

            document.getElementById('errorMessages').innerText = '';
            document.getElementById('successMessage').innerText = 'Pedido Submetido com sucesso!';

            const detalhesHTML = `
                <h2>Detalhes do Pedido</h2>
                <p><strong>Nome:</strong> ${nome}</p>
                <p><strong>Tipo de Dias:</strong> ${tipoDias}</p>
                <p><strong>Data de Início:</strong> ${dataInicio}</p>
                <p><strong>Data de Fim:</strong> ${dataFim}</p>
                <p><strong>Total de Dias:</strong> ${dias}</p>
            `;
            document.getElementById('detalhesReserva').innerHTML = detalhesHTML;

            enviarParaSupabase({
                nome: nome,
                tipoDias: tipoDias,
                dataInicio: dataInicio,
                dataFim: dataFim,
                totalDias: dias
            });
        });

        function novoPedido() {
            document.getElementById('reservaForm').reset();
            document.getElementById('detalhesReserva').innerHTML = '';
            document.getElementById('diasCalculados').innerText = 'Dias úteis calculados: 0';
            document.getElementById('successMessage').innerText = '';
            document.getElementById('novoPedidoBtn').style.display = 'none';
        }

        function verificarSenha() {
            const senha = document.getElementById('password').value;
            const senhaCorreta = "senha123";

            if (senha === senhaCorreta) {
                document.getElementById('passwordPrompt').style.display = 'none';
                document.getElementById('formContainer').style.display = 'block';
            } else {
                document.getElementById('senhaErro').style.display = 'block';
            }
        }
    </script>
</body>
</html>
